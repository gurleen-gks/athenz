/**
 * Copyright 2016 Yahoo Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */'use strict';var cov_o31d2tihf=function(){var path='/Users/gurleenk/athenz_repo_new/athenz/ui/src/routeHandlers/policy.js',hash='3ff01efb783b04d1f06ca0677dd496d9886592d5',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/gurleenk/athenz_repo_new/athenz/ui/src/routeHandlers/policy.js',statementMap:{'0':{start:{line:18,column:16},end:{line:18,column:40}},'1':{start:{line:19,column:16},end:{line:19,column:40}},'2':{start:{line:20,column:15},end:{line:20,column:38}},'3':{start:{line:21,column:11},end:{line:21,column:35}},'4':{start:{line:23,column:22},end:{line:25,column:1}},'5':{start:{line:24,column:2},end:{line:24,column:71}},'6':{start:{line:27,column:0},end:{line:117,column:2}},'7':{start:{line:29,column:4},end:{line:29,column:39}},'8':{start:{line:30,column:17},end:{line:35,column:5}},'9':{start:{line:37,column:4},end:{line:50,column:8}},'10':{start:{line:38,column:6},end:{line:38,column:31}},'11':{start:{line:39,column:6},end:{line:39,column:44}},'12':{start:{line:40,column:6},end:{line:40,column:43}},'13':{start:{line:41,column:6},end:{line:43,column:9}},'14':{start:{line:42,column:8},end:{line:42,column:121}},'15':{start:{line:45,column:6},end:{line:49,column:9}},'16':{start:{line:53,column:4},end:{line:53,column:39}},'17':{start:{line:54,column:17},end:{line:66,column:5}},'18':{start:{line:68,column:4},end:{line:80,column:8}},'19':{start:{line:69,column:19},end:{line:69,column:32}},'20':{start:{line:70,column:6},end:{line:70,column:31}},'21':{start:{line:71,column:6},end:{line:71,column:35}},'22':{start:{line:72,column:6},end:{line:72,column:44}},'23':{start:{line:73,column:6},end:{line:73,column:43}},'24':{start:{line:75,column:6},end:{line:79,column:9}},'25':{start:{line:83,column:17},end:{line:86,column:5}},'26':{start:{line:87,column:4},end:{line:87,column:72}},'27':{start:{line:90,column:17},end:{line:94,column:5}},'28':{start:{line:95,column:4},end:{line:95,column:74}},'29':{start:{line:98,column:17},end:{line:108,column:5}},'30':{start:{line:109,column:4},end:{line:115,column:8}},'31':{start:{line:110,column:6},end:{line:110,column:38}},'32':{start:{line:111,column:6},end:{line:111,column:36}},'33':{start:{line:112,column:6},end:{line:113,column:104}},'34':{start:{line:114,column:6},end:{line:114,column:60}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:23,column:22},end:{line:23,column:23}},loc:{start:{line:23,column:51},end:{line:25,column:1}},line:23},'1':{name:'(anonymous_1)',decl:{start:{line:28,column:16},end:{line:28,column:17}},loc:{start:{line:28,column:35},end:{line:51,column:3}},line:28},'2':{name:'(anonymous_2)',decl:{start:{line:37,column:67},end:{line:37,column:68}},loc:{start:{line:37,column:84},end:{line:50,column:5}},line:37},'3':{name:'(anonymous_3)',decl:{start:{line:41,column:32},end:{line:41,column:33}},loc:{start:{line:41,column:45},end:{line:43,column:7}},line:41},'4':{name:'(anonymous_4)',decl:{start:{line:52,column:13},end:{line:52,column:14}},loc:{start:{line:52,column:32},end:{line:81,column:3}},line:52},'5':{name:'(anonymous_5)',decl:{start:{line:68,column:67},end:{line:68,column:68}},loc:{start:{line:68,column:78},end:{line:80,column:5}},line:68},'6':{name:'(anonymous_6)',decl:{start:{line:82,column:16},end:{line:82,column:17}},loc:{start:{line:82,column:35},end:{line:88,column:3}},line:82},'7':{name:'(anonymous_7)',decl:{start:{line:89,column:19},end:{line:89,column:20}},loc:{start:{line:89,column:38},end:{line:96,column:3}},line:89},'8':{name:'(anonymous_8)',decl:{start:{line:97,column:16},end:{line:97,column:17}},loc:{start:{line:97,column:35},end:{line:116,column:3}},line:97},'9':{name:'(anonymous_9)',decl:{start:{line:109,column:70},end:{line:109,column:71}},loc:{start:{line:109,column:85},end:{line:115,column:5}},line:109}},branchMap:{'0':{loc:{start:{line:24,column:9},end:{line:24,column:70}},type:'cond-expr',locations:[{start:{line:24,column:34},end:{line:24,column:42}},{start:{line:24,column:45},end:{line:24,column:70}}],line:24}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0},b:{'0':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var pageUtils=(cov_o31d2tihf.s[0]++,require('../utils/page'));var viewUtils=(cov_o31d2tihf.s[1]++,require('../utils/view'));var reqUtils=(cov_o31d2tihf.s[2]++,require('../utils/req'));var conf=(cov_o31d2tihf.s[3]++,require('../utils/conf'));cov_o31d2tihf.s[4]++;var getResourceName=function(resource,domainId){cov_o31d2tihf.f[0]++;cov_o31d2tihf.s[5]++;return resource.includes(':')?(cov_o31d2tihf.b[0][0]++,resource):(cov_o31d2tihf.b[0][1]++,`${domainId}:${resource}`);};cov_o31d2tihf.s[6]++;module.exports={getPolicyRow:function(req,res){cov_o31d2tihf.f[1]++;cov_o31d2tihf.s[7]++;pageUtils.initCommonData(req,res);var params=(cov_o31d2tihf.s[8]++,{domainName:req.params.domainId,policyName:req.params.policy,expand:true,auditLog:true});cov_o31d2tihf.s[9]++;req.restClient.getPolicy(params,reqUtils.ajaxHtmlHandler(res,function(policy){cov_o31d2tihf.f[2]++;cov_o31d2tihf.s[10]++;policy.active='active';cov_o31d2tihf.s[11]++;policy.domainId=req.params.domainId;cov_o31d2tihf.s[12]++;viewUtils.populatePolicyData(policy);cov_o31d2tihf.s[13]++;policy.assertions.forEach(assertion=>{cov_o31d2tihf.f[3]++;cov_o31d2tihf.s[14]++;assertion.deleteUrl=`/athenz/domain/${policy.domainId}/policy/${policy.name}/assertion/${assertion.id}/delete`;});cov_o31d2tihf.s[15]++;res.render('policyrow',{layout:false,policyTypes:conf.POLICY_TYPES,policies:[policy]});}));},addPolicy:function(req,res){cov_o31d2tihf.f[4]++;cov_o31d2tihf.s[16]++;pageUtils.initCommonData(req,res);var params=(cov_o31d2tihf.s[17]++,{domainName:req.params.domainId,policyName:req.body.name,policy:{name:req.params.domainId+':policy.'+req.body.name,assertions:[{role:`${req.params.domainId}:role.${req.body.role}`,resource:getResourceName(req.body.resource,req.params.domainId),effect:req.body.effect,action:req.body.action}]}});cov_o31d2tihf.s[18]++;req.restClient.putPolicy(params,reqUtils.ajaxHtmlHandler(res,function(){cov_o31d2tihf.f[5]++;var policy=(cov_o31d2tihf.s[19]++,params.policy);cov_o31d2tihf.s[20]++;policy.active='active';cov_o31d2tihf.s[21]++;policy.modified=new Date();cov_o31d2tihf.s[22]++;policy.domainId=req.params.domainId;cov_o31d2tihf.s[23]++;viewUtils.populatePolicyData(policy);cov_o31d2tihf.s[24]++;res.render('policyrow',{layout:false,policyTypes:conf.POLICY_TYPES,policies:[policy]});}));},deletePolicy:function(req,res){cov_o31d2tihf.f[6]++;var params=(cov_o31d2tihf.s[25]++,{domainName:req.params.domainId,policyName:req.params.policy});cov_o31d2tihf.s[26]++;req.restClient.deletePolicy(params,reqUtils.ajaxJsonHandler(res));},deleteAssertion:function(req,res){cov_o31d2tihf.f[7]++;var params=(cov_o31d2tihf.s[27]++,{domainName:req.params.domainId,policyName:req.params.policy,assertionId:req.params.id});cov_o31d2tihf.s[28]++;req.restClient.deleteAssertion(params,reqUtils.ajaxJsonHandler(res));},addAssertion:function(req,res){cov_o31d2tihf.f[8]++;var params=(cov_o31d2tihf.s[29]++,{domainName:req.params.domainId,policyName:req.params.policy,assertion:{role:`${req.params.domainId}:role.${req.body.role}`,resource:getResourceName(req.body.resource,req.params.domainId),effect:req.body.effect,action:req.body.action}});cov_o31d2tihf.s[30]++;req.restClient.putAssertion(params,reqUtils.ajaxHtmlHandler(res,function(data){cov_o31d2tihf.f[9]++;cov_o31d2tihf.s[31]++;params.assertion.layout=false;cov_o31d2tihf.s[32]++;params.assertion.id=data.id;cov_o31d2tihf.s[33]++;params.assertion.deleteUrl=`/athenz/domain/${params.domainName}/policy/${params.policyName}/assertion/${data.id}/delete`;cov_o31d2tihf.s[34]++;res.render('partials/assertionrow',params.assertion);}));}};