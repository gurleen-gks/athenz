/**
 * Copyright 2016 Yahoo Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 *
 * Contains util functions which pertain to overall page rendering and common
 * callback functions
 */'use strict';var cov_1n52i5yf2s=function(){var path='/Users/gurleenk/athenz_repo_new/athenz/ui/src/utils/view.js',hash='bd50760136bb28aee321950cea781e9b16ea24f8',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/gurleenk/athenz_repo_new/athenz/ui/src/utils/view.js',statementMap:{'0':{start:{line:22,column:8},end:{line:22,column:25}},'1':{start:{line:23,column:13},end:{line:23,column:48}},'2':{start:{line:25,column:0},end:{line:120,column:2}},'3':{start:{line:30,column:4},end:{line:32,column:5}},'4':{start:{line:31,column:6},end:{line:31,column:37}},'5':{start:{line:35,column:4},end:{line:37,column:5}},'6':{start:{line:36,column:6},end:{line:36,column:23}},'7':{start:{line:40,column:4},end:{line:40,column:30}},'8':{start:{line:42,column:23},end:{line:44,column:6}},'9':{start:{line:43,column:6},end:{line:43,column:34}},'10':{start:{line:46,column:4},end:{line:51,column:5}},'11':{start:{line:47,column:20},end:{line:47,column:38}},'12':{start:{line:48,column:6},end:{line:48,column:38}},'13':{start:{line:49,column:6},end:{line:49,column:35}},'14':{start:{line:50,column:6},end:{line:50,column:28}},'15':{start:{line:53,column:4},end:{line:53,column:16}},'16':{start:{line:56,column:14},end:{line:56,column:24}},'17':{start:{line:57,column:4},end:{line:57,column:91}},'18':{start:{line:60,column:4},end:{line:60,column:49}},'19':{start:{line:63,column:17},end:{line:65,column:5}},'20':{start:{line:67,column:4},end:{line:69,column:5}},'21':{start:{line:68,column:6},end:{line:68,column:88}},'22':{start:{line:70,column:4},end:{line:70,column:18}},'23':{start:{line:73,column:19},end:{line:73,column:55}},'24':{start:{line:74,column:4},end:{line:74,column:30}},'25':{start:{line:75,column:4},end:{line:75,column:25}},'26':{start:{line:76,column:4},end:{line:76,column:79}},'27':{start:{line:77,column:4},end:{line:77,column:39}},'28':{start:{line:78,column:4},end:{line:81,column:5}},'29':{start:{line:80,column:6},end:{line:80,column:60}},'30':{start:{line:82,column:4},end:{line:93,column:5}},'31':{start:{line:83,column:6},end:{line:83,column:30}},'32':{start:{line:85,column:6},end:{line:92,column:15}},'33':{start:{line:86,column:8},end:{line:91,column:10}},'34':{start:{line:94,column:4},end:{line:94,column:16}},'35':{start:{line:97,column:22},end:{line:97,column:71}},'36':{start:{line:98,column:4},end:{line:98,column:36}},'37':{start:{line:99,column:4},end:{line:99,column:31}},'38':{start:{line:100,column:4},end:{line:100,column:91}},'39':{start:{line:101,column:4},end:{line:101,column:92}},'40':{start:{line:102,column:4},end:{line:102,column:40}},'41':{start:{line:103,column:4},end:{line:103,column:19}},'42':{start:{line:106,column:4},end:{line:106,column:34}},'43':{start:{line:107,column:4},end:{line:107,column:59}},'44':{start:{line:108,column:4},end:{line:108,column:88}},'45':{start:{line:109,column:4},end:{line:109,column:98}},'46':{start:{line:110,column:4},end:{line:110,column:18}},'47':{start:{line:113,column:16},end:{line:113,column:59}},'48':{start:{line:113,column:40},end:{line:113,column:58}},'49':{start:{line:114,column:4},end:{line:117,column:5}},'50':{start:{line:115,column:14},end:{line:115,column:36}},'51':{start:{line:116,column:6},end:{line:116,column:26}},'52':{start:{line:118,column:4},end:{line:118,column:17}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:29,column:10},end:{line:29,column:11}},loc:{start:{line:29,column:61},end:{line:33,column:3}},line:29},'1':{name:'(anonymous_1)',decl:{start:{line:34,column:10},end:{line:34,column:11}},loc:{start:{line:34,column:48},end:{line:38,column:3}},line:34},'2':{name:'(anonymous_2)',decl:{start:{line:39,column:20},end:{line:39,column:21}},loc:{start:{line:39,column:48},end:{line:54,column:3}},line:39},'3':{name:'(anonymous_3)',decl:{start:{line:42,column:41},end:{line:42,column:42}},loc:{start:{line:42,column:56},end:{line:44,column:5}},line:42},'4':{name:'(anonymous_4)',decl:{start:{line:55,column:16},end:{line:55,column:17}},loc:{start:{line:55,column:37},end:{line:58,column:3}},line:55},'5':{name:'(anonymous_5)',decl:{start:{line:59,column:15},end:{line:59,column:16}},loc:{start:{line:59,column:30},end:{line:61,column:3}},line:59},'6':{name:'(anonymous_6)',decl:{start:{line:62,column:19},end:{line:62,column:20}},loc:{start:{line:62,column:36},end:{line:71,column:3}},line:62},'7':{name:'(anonymous_7)',decl:{start:{line:72,column:20},end:{line:72,column:21}},loc:{start:{line:72,column:35},end:{line:95,column:3}},line:72},'8':{name:'(anonymous_8)',decl:{start:{line:85,column:40},end:{line:85,column:41}},loc:{start:{line:85,column:56},end:{line:92,column:7}},line:85},'9':{name:'(anonymous_9)',decl:{start:{line:96,column:23},end:{line:96,column:24}},loc:{start:{line:96,column:41},end:{line:104,column:3}},line:96},'10':{name:'(anonymous_10)',decl:{start:{line:105,column:22},end:{line:105,column:23}},loc:{start:{line:105,column:39},end:{line:111,column:3}},line:105},'11':{name:'(anonymous_11)',decl:{start:{line:112,column:12},end:{line:112,column:13}},loc:{start:{line:112,column:34},end:{line:119,column:3}},line:112},'12':{name:'(anonymous_12)',decl:{start:{line:113,column:32},end:{line:113,column:33}},loc:{start:{line:113,column:40},end:{line:113,column:58}},line:113}},branchMap:{'0':{loc:{start:{line:30,column:4},end:{line:32,column:5}},type:'if',locations:[{start:{line:30,column:4},end:{line:32,column:5}},{start:{line:30,column:4},end:{line:32,column:5}}],line:30},'1':{loc:{start:{line:35,column:4},end:{line:37,column:5}},type:'if',locations:[{start:{line:35,column:4},end:{line:37,column:5}},{start:{line:35,column:4},end:{line:37,column:5}}],line:35},'2':{loc:{start:{line:40,column:14},end:{line:40,column:29}},type:'binary-expr',locations:[{start:{line:40,column:14},end:{line:40,column:21}},{start:{line:40,column:25},end:{line:40,column:29}}],line:40},'3':{loc:{start:{line:46,column:4},end:{line:51,column:5}},type:'if',locations:[{start:{line:46,column:4},end:{line:51,column:5}},{start:{line:46,column:4},end:{line:51,column:5}}],line:46},'4':{loc:{start:{line:57,column:11},end:{line:57,column:90}},type:'cond-expr',locations:[{start:{line:57,column:40},end:{line:57,column:83}},{start:{line:57,column:86},end:{line:57,column:90}}],line:57},'5':{loc:{start:{line:57,column:11},end:{line:57,column:37}},type:'binary-expr',locations:[{start:{line:57,column:11},end:{line:57,column:15}},{start:{line:57,column:19},end:{line:57,column:37}}],line:57},'6':{loc:{start:{line:60,column:12},end:{line:60,column:48}},type:'cond-expr',locations:[{start:{line:60,column:25},end:{line:60,column:36}},{start:{line:60,column:39},end:{line:60,column:48}}],line:60},'7':{loc:{start:{line:67,column:4},end:{line:69,column:5}},type:'if',locations:[{start:{line:67,column:4},end:{line:69,column:5}},{start:{line:67,column:4},end:{line:69,column:5}}],line:67},'8':{loc:{start:{line:78,column:4},end:{line:81,column:5}},type:'if',locations:[{start:{line:78,column:4},end:{line:81,column:5}},{start:{line:78,column:4},end:{line:81,column:5}}],line:78},'9':{loc:{start:{line:82,column:4},end:{line:93,column:5}},type:'if',locations:[{start:{line:82,column:4},end:{line:93,column:5}},{start:{line:82,column:4},end:{line:93,column:5}}],line:82},'10':{loc:{start:{line:102,column:19},end:{line:102,column:39}},type:'binary-expr',locations:[{start:{line:102,column:19},end:{line:102,column:31}},{start:{line:102,column:35},end:{line:102,column:39}}],line:102},'11':{loc:{start:{line:114,column:4},end:{line:117,column:5}},type:'if',locations:[{start:{line:114,column:4},end:{line:117,column:5}},{start:{line:114,column:4},end:{line:117,column:5}}],line:114}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var _=(cov_1n52i5yf2s.s[0]++,require('lodash'));var config=(cov_1n52i5yf2s.s[1]++,require('../../config/config.js')());cov_1n52i5yf2s.s[2]++;module.exports={/**
   * Call response.render() based on pending parallel API calls
   */render:function(res,viewName,viewData,pendingApiCount){cov_1n52i5yf2s.f[0]++;cov_1n52i5yf2s.s[3]++;if(pendingApiCount===0){cov_1n52i5yf2s.b[0][0]++;cov_1n52i5yf2s.s[4]++;res.render(viewName,viewData);}else{cov_1n52i5yf2s.b[0][1]++;}},callCb:function(cb,output,pendingApiCount){cov_1n52i5yf2s.f[1]++;cov_1n52i5yf2s.s[5]++;if(pendingApiCount===0){cov_1n52i5yf2s.b[1][0]++;cov_1n52i5yf2s.s[6]++;cb(null,output);}else{cov_1n52i5yf2s.b[1][1]++;}},highlightCurrent:function(list,id,idIndex){cov_1n52i5yf2s.f[2]++;cov_1n52i5yf2s.s[7]++;idIndex=(cov_1n52i5yf2s.b[2][0]++,idIndex)||(cov_1n52i5yf2s.b[2][1]++,'id');var currentIndex=(cov_1n52i5yf2s.s[8]++,_.findIndex(list,function(item){cov_1n52i5yf2s.f[3]++;cov_1n52i5yf2s.s[9]++;return item[idIndex]===id;}));cov_1n52i5yf2s.s[10]++;if(currentIndex>=0){cov_1n52i5yf2s.b[3][0]++;var current=(cov_1n52i5yf2s.s[11]++,list[currentIndex]);cov_1n52i5yf2s.s[12]++;current.highlight='highlight';cov_1n52i5yf2s.s[13]++;list.splice(currentIndex,1);cov_1n52i5yf2s.s[14]++;list.unshift(current);}else{cov_1n52i5yf2s.b[3][1]++;}cov_1n52i5yf2s.s[15]++;return list;},getShortName:function(name,type){cov_1n52i5yf2s.f[4]++;var key=(cov_1n52i5yf2s.s[16]++,`${type}.`);cov_1n52i5yf2s.s[17]++;return(cov_1n52i5yf2s.b[5][0]++,name)&&(cov_1n52i5yf2s.b[5][1]++,name.includes(key))?(cov_1n52i5yf2s.b[4][0]++,name.substr(name.indexOf(key)+key.length)):(cov_1n52i5yf2s.b[4][1]++,name);},getRoleType:function(role){cov_1n52i5yf2s.f[5]++;cov_1n52i5yf2s.s[18]++;return role.trust?(cov_1n52i5yf2s.b[6][0]++,'Delegated'):(cov_1n52i5yf2s.b[6][1]++,'Regular');},getMemberDetail:function(member){cov_1n52i5yf2s.f[6]++;var detail=(cov_1n52i5yf2s.s[19]++,{name:member});cov_1n52i5yf2s.s[20]++;if(member.startsWith(config.userDomain+'.')){cov_1n52i5yf2s.b[7][0]++;cov_1n52i5yf2s.s[21]++;detail.userlink=config.userLink(member.substring(config.userDomain.length+1));}else{cov_1n52i5yf2s.b[7][1]++;}cov_1n52i5yf2s.s[22]++;return detail;},populateRoleData:function(role){cov_1n52i5yf2s.f[7]++;var roleName=(cov_1n52i5yf2s.s[23]++,this.getShortName(role.name,'role'));cov_1n52i5yf2s.s[24]++;role.fullName=role.name;cov_1n52i5yf2s.s[25]++;role.name=roleName;cov_1n52i5yf2s.s[26]++;role.deleteUrl=`/athenz/domain/${role.domainId}/role/${roleName}/delete`;cov_1n52i5yf2s.s[27]++;role.type=this.getRoleType(role);cov_1n52i5yf2s.s[28]++;if(role.members){cov_1n52i5yf2s.b[8][0]++;cov_1n52i5yf2s.s[29]++;// Fill user links
role.members=role.members.map(this.getMemberDetail);}else{cov_1n52i5yf2s.b[8][1]++;}cov_1n52i5yf2s.s[30]++;if(Array.isArray(role.auditLog)){cov_1n52i5yf2s.b[9][0]++;cov_1n52i5yf2s.s[31]++;role.auditLog.reverse();// Fill user links
cov_1n52i5yf2s.s[32]++;role.auditLog=role.auditLog.map(function(entry){cov_1n52i5yf2s.f[8]++;cov_1n52i5yf2s.s[33]++;return{action:entry.action,admin:this.getMemberDetail(entry.admin),created:entry.created,member:this.getMemberDetail(entry.member)};},this);}else{cov_1n52i5yf2s.b[9][1]++;}cov_1n52i5yf2s.s[34]++;return role;},populateServiceData:function(service){cov_1n52i5yf2s.f[9]++;var serviceName=(cov_1n52i5yf2s.s[35]++,this.getShortName(service.name,service.domainId));cov_1n52i5yf2s.s[36]++;service.fullName=service.name;cov_1n52i5yf2s.s[37]++;service.name=serviceName;cov_1n52i5yf2s.s[38]++;service.deleteUrl=`/athenz/domain/${service.domainId}/service/${serviceName}/delete`;cov_1n52i5yf2s.s[39]++;service.addKeyUrl=`/athenz/domain/${service.domainId}/service/${serviceName}/key/add`;cov_1n52i5yf2s.s[40]++;service.user=(cov_1n52i5yf2s.b[10][0]++,service.user)||(cov_1n52i5yf2s.b[10][1]++,null);cov_1n52i5yf2s.s[41]++;return service;},populatePolicyData:function(policy){cov_1n52i5yf2s.f[10]++;cov_1n52i5yf2s.s[42]++;policy.fullName=policy.name;cov_1n52i5yf2s.s[43]++;policy.name=this.getShortName(policy.name,'policy');cov_1n52i5yf2s.s[44]++;policy.deleteUrl=`/athenz/domain/${policy.domainId}/policy/${policy.name}/delete`;cov_1n52i5yf2s.s[45]++;policy.addAssertion=`/athenz/domain/${policy.domainId}/policy/${policy.name}/assertion/add`;cov_1n52i5yf2s.s[46]++;return policy;},moveRole:function(roles,name){cov_1n52i5yf2s.f[11]++;var index=(cov_1n52i5yf2s.s[47]++,roles.findIndex(role=>{cov_1n52i5yf2s.f[12]++;cov_1n52i5yf2s.s[48]++;return role.name===name;}));cov_1n52i5yf2s.s[49]++;if(index!==-1){cov_1n52i5yf2s.b[11][0]++;var r=(cov_1n52i5yf2s.s[50]++,roles.splice(index,1));cov_1n52i5yf2s.s[51]++;roles.unshift(r[0]);}else{cov_1n52i5yf2s.b[11][1]++;}cov_1n52i5yf2s.s[52]++;return roles;}};