/**
 * Copyright 2016 Yahoo Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */'use strict';var cov_1iacrze5fp=function(){var path='/Users/gurleenk/athenz_repo_new/athenz/ui/src/api/roles.js',hash='b5c0546ddcd1a83943da2d9fef0ece9ab87d94b4',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/gurleenk/athenz_repo_new/athenz/ui/src/api/roles.js',statementMap:{'0':{start:{line:18,column:22},end:{line:18,column:52}},'1':{start:{line:19,column:16},end:{line:19,column:40}},'2':{start:{line:20,column:15},end:{line:20,column:38}},'3':{start:{line:21,column:13},end:{line:21,column:48}},'4':{start:{line:24,column:14},end:{line:24,column:63}},'5':{start:{line:25,column:2},end:{line:27,column:3}},'6':{start:{line:26,column:4},end:{line:26,column:51}},'7':{start:{line:29,column:14},end:{line:29,column:16}},'8':{start:{line:30,column:2},end:{line:42,column:4}},'9':{start:{line:31,column:15},end:{line:31,column:19}},'10':{start:{line:32,column:4},end:{line:35,column:6}},'11':{start:{line:36,column:4},end:{line:39,column:5}},'12':{start:{line:37,column:6},end:{line:37,column:31}},'13':{start:{line:38,column:6},end:{line:38,column:54}},'14':{start:{line:41,column:4},end:{line:41,column:41}},'15':{start:{line:45,column:0},end:{line:111,column:2}},'16':{start:{line:47,column:21},end:{line:47,column:63}},'17':{start:{line:48,column:4},end:{line:56,column:7}},'18':{start:{line:52,column:6},end:{line:54,column:7}},'19':{start:{line:53,column:8},end:{line:53,column:35}},'20':{start:{line:55,column:6},end:{line:55,column:14}},'21':{start:{line:59,column:4},end:{line:74,column:7}},'22':{start:{line:63,column:20},end:{line:63,column:22}},'23':{start:{line:64,column:6},end:{line:72,column:7}},'24':{start:{line:65,column:8},end:{line:70,column:11}},'25':{start:{line:66,column:10},end:{line:68,column:11}},'26':{start:{line:67,column:12},end:{line:67,column:68}},'27':{start:{line:69,column:10},end:{line:69,column:24}},'28':{start:{line:71,column:8},end:{line:71,column:33}},'29':{start:{line:73,column:6},end:{line:73,column:23}},'30':{start:{line:77,column:17},end:{line:77,column:63}},'31':{start:{line:78,column:4},end:{line:80,column:5}},'32':{start:{line:79,column:6},end:{line:79,column:13}},'33':{start:{line:82,column:4},end:{line:93,column:7}},'34':{start:{line:83,column:19},end:{line:91,column:7}},'35':{start:{line:92,column:6},end:{line:92,column:58}},'36':{start:{line:96,column:17},end:{line:96,column:63}},'37':{start:{line:97,column:4},end:{line:99,column:5}},'38':{start:{line:98,column:6},end:{line:98,column:13}},'39':{start:{line:101,column:4},end:{line:109,column:7}},'40':{start:{line:102,column:19},end:{line:107,column:7}},'41':{start:{line:108,column:6},end:{line:108,column:61}}},fnMap:{'0':{name:'getModifyRoleMemberHandlerCb',decl:{start:{line:23,column:9},end:{line:23,column:37}},loc:{start:{line:23,column:54},end:{line:43,column:1}},line:23},'1':{name:'(anonymous_1)',decl:{start:{line:30,column:9},end:{line:30,column:10}},loc:{start:{line:30,column:23},end:{line:42,column:3}},line:30},'2':{name:'(anonymous_2)',decl:{start:{line:46,column:14},end:{line:46,column:15}},loc:{start:{line:46,column:47},end:{line:57,column:3}},line:46},'3':{name:'(anonymous_3)',decl:{start:{line:51,column:7},end:{line:51,column:8}},loc:{start:{line:51,column:27},end:{line:56,column:5}},line:51},'4':{name:'(anonymous_4)',decl:{start:{line:58,column:13},end:{line:58,column:14}},loc:{start:{line:58,column:46},end:{line:75,column:3}},line:58},'5':{name:'(anonymous_5)',decl:{start:{line:62,column:7},end:{line:62,column:8}},loc:{start:{line:62,column:31},end:{line:74,column:5}},line:62},'6':{name:'(anonymous_6)',decl:{start:{line:65,column:39},end:{line:65,column:40}},loc:{start:{line:65,column:56},end:{line:70,column:9}},line:65},'7':{name:'(anonymous_7)',decl:{start:{line:76,column:13},end:{line:76,column:14}},loc:{start:{line:76,column:46},end:{line:94,column:3}},line:76},'8':{name:'(anonymous_8)',decl:{start:{line:82,column:25},end:{line:82,column:26}},loc:{start:{line:82,column:40},end:{line:93,column:5}},line:82},'9':{name:'(anonymous_9)',decl:{start:{line:95,column:16},end:{line:95,column:17}},loc:{start:{line:95,column:49},end:{line:110,column:3}},line:95},'10':{name:'(anonymous_10)',decl:{start:{line:101,column:25},end:{line:101,column:26}},loc:{start:{line:101,column:40},end:{line:109,column:5}},line:101}},branchMap:{'0':{loc:{start:{line:24,column:14},end:{line:24,column:63}},type:'cond-expr',locations:[{start:{line:24,column:42},end:{line:24,column:59}},{start:{line:24,column:62},end:{line:24,column:63}}],line:24},'1':{loc:{start:{line:25,column:2},end:{line:27,column:3}},type:'if',locations:[{start:{line:25,column:2},end:{line:27,column:3}},{start:{line:25,column:2},end:{line:27,column:3}}],line:25},'2':{loc:{start:{line:36,column:4},end:{line:39,column:5}},type:'if',locations:[{start:{line:36,column:4},end:{line:39,column:5}},{start:{line:36,column:4},end:{line:39,column:5}}],line:36},'3':{loc:{start:{line:52,column:6},end:{line:54,column:7}},type:'if',locations:[{start:{line:52,column:6},end:{line:54,column:7}},{start:{line:52,column:6},end:{line:54,column:7}}],line:52},'4':{loc:{start:{line:52,column:10},end:{line:52,column:50}},type:'binary-expr',locations:[{start:{line:52,column:10},end:{line:52,column:14}},{start:{line:52,column:18},end:{line:52,column:22}},{start:{line:52,column:26},end:{line:52,column:50}}],line:52},'5':{loc:{start:{line:64,column:6},end:{line:72,column:7}},type:'if',locations:[{start:{line:64,column:6},end:{line:72,column:7}},{start:{line:64,column:6},end:{line:72,column:7}}],line:64},'6':{loc:{start:{line:64,column:10},end:{line:64,column:61}},type:'binary-expr',locations:[{start:{line:64,column:10},end:{line:64,column:14}},{start:{line:64,column:18},end:{line:64,column:26}},{start:{line:64,column:30},end:{line:64,column:61}}],line:64},'7':{loc:{start:{line:66,column:10},end:{line:68,column:11}},type:'if',locations:[{start:{line:66,column:10},end:{line:68,column:11}},{start:{line:66,column:10},end:{line:68,column:11}}],line:66},'8':{loc:{start:{line:78,column:4},end:{line:80,column:5}},type:'if',locations:[{start:{line:78,column:4},end:{line:80,column:5}},{start:{line:78,column:4},end:{line:80,column:5}}],line:78},'9':{loc:{start:{line:97,column:4},end:{line:99,column:5}},type:'if',locations:[{start:{line:97,column:4},end:{line:99,column:5}},{start:{line:97,column:4},end:{line:99,column:5}}],line:97}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0,0],'5':[0,0],'6':[0,0,0],'7':[0,0],'8':[0,0],'9':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var paginationUtils=(cov_1iacrze5fp.s[0]++,require('../utils/pagination'));var viewUtils=(cov_1iacrze5fp.s[1]++,require('../utils/view'));var reqUtils=(cov_1iacrze5fp.s[2]++,require('../utils/req'));var config=(cov_1iacrze5fp.s[3]++,require('../../config/config.js')());function getModifyRoleMemberHandlerCb(inputRoles,cb){cov_1iacrze5fp.f[0]++;var count=(cov_1iacrze5fp.s[4]++,Array.isArray(inputRoles)?(cov_1iacrze5fp.b[0][0]++,inputRoles.length):(cov_1iacrze5fp.b[0][1]++,0));cov_1iacrze5fp.s[5]++;if(!count){cov_1iacrze5fp.b[1][0]++;cov_1iacrze5fp.s[6]++;return cb('Roles is not an array',inputRoles);}else{cov_1iacrze5fp.b[1][1]++;}var roles=(cov_1iacrze5fp.s[7]++,{});cov_1iacrze5fp.s[8]++;return function(err){cov_1iacrze5fp.f[1]++;var role=(cov_1iacrze5fp.s[9]++,this);cov_1iacrze5fp.s[10]++;roles[role]={error:false,msg:''};cov_1iacrze5fp.s[11]++;if(err){cov_1iacrze5fp.b[2][0]++;cov_1iacrze5fp.s[12]++;roles[role].error=true;cov_1iacrze5fp.s[13]++;roles[role].msg=reqUtils.getErrorMessage(err);}else{cov_1iacrze5fp.b[2][1]++;}cov_1iacrze5fp.s[14]++;viewUtils.callCb(cb,roles,--count);};}cov_1iacrze5fp.s[15]++;module.exports={fetchRoles:function(params,restClient,cb){cov_1iacrze5fp.f[2]++;var pageParams=(cov_1iacrze5fp.s[16]++,paginationUtils.populateQueryParams('all'));cov_1iacrze5fp.s[17]++;restClient.getRoles({limit:pageParams.count,domainName:params.domainId},function(err,json){cov_1iacrze5fp.f[3]++;cov_1iacrze5fp.s[18]++;if((cov_1iacrze5fp.b[4][0]++,!err)&&(cov_1iacrze5fp.b[4][1]++,json)&&(cov_1iacrze5fp.b[4][2]++,Array.isArray(json.list))){cov_1iacrze5fp.b[3][0]++;cov_1iacrze5fp.s[19]++;return cb(null,json.list);}else{cov_1iacrze5fp.b[3][1]++;}cov_1iacrze5fp.s[20]++;cb(err);});},fetchRole:function(params,restClient,cb){cov_1iacrze5fp.f[4]++;cov_1iacrze5fp.s[21]++;restClient.getRole({domainName:params.domainId,roleName:params.roleId},function(err,roleData){cov_1iacrze5fp.f[5]++;var members=(cov_1iacrze5fp.s[22]++,[]);cov_1iacrze5fp.s[23]++;if((cov_1iacrze5fp.b[6][0]++,!err)&&(cov_1iacrze5fp.b[6][1]++,roleData)&&(cov_1iacrze5fp.b[6][2]++,Array.isArray(roleData.members))){cov_1iacrze5fp.b[5][0]++;cov_1iacrze5fp.s[24]++;members=roleData.members.map(function(member){cov_1iacrze5fp.f[6]++;cov_1iacrze5fp.s[25]++;if(member.startsWith(config.userDomain+'.')){cov_1iacrze5fp.b[7][0]++;cov_1iacrze5fp.s[26]++;member=member.substring(config.userDomain.length+1);}else{cov_1iacrze5fp.b[7][1]++;}cov_1iacrze5fp.s[27]++;return member;});cov_1iacrze5fp.s[28]++;return cb(null,members);}else{cov_1iacrze5fp.b[5][1]++;}cov_1iacrze5fp.s[29]++;cb(err,members);});},addMember:function(params,restClient,cb){cov_1iacrze5fp.f[7]++;var roleCb=(cov_1iacrze5fp.s[30]++,getModifyRoleMemberHandlerCb(params.roles,cb));cov_1iacrze5fp.s[31]++;if(typeof roleCb!=='function'){cov_1iacrze5fp.b[8][0]++;cov_1iacrze5fp.s[32]++;return;}else{cov_1iacrze5fp.b[8][1]++;}cov_1iacrze5fp.s[33]++;params.roles.forEach(function(role){cov_1iacrze5fp.f[8]++;var fields=(cov_1iacrze5fp.s[34]++,{domainName:params.domain,roleName:role,memberName:params.member,auditRef:'',membership:{memberName:params.member}});cov_1iacrze5fp.s[35]++;restClient.putMembership(fields,roleCb.bind(role));});},deleteMember:function(params,restClient,cb){cov_1iacrze5fp.f[9]++;var roleCb=(cov_1iacrze5fp.s[36]++,getModifyRoleMemberHandlerCb(params.roles,cb));cov_1iacrze5fp.s[37]++;if(typeof roleCb!=='function'){cov_1iacrze5fp.b[9][0]++;cov_1iacrze5fp.s[38]++;return;}else{cov_1iacrze5fp.b[9][1]++;}cov_1iacrze5fp.s[39]++;params.roles.forEach(function(role){cov_1iacrze5fp.f[10]++;var fields=(cov_1iacrze5fp.s[40]++,{domainName:params.domain,roleName:role,memberName:params.member,auditRef:''});cov_1iacrze5fp.s[41]++;restClient.deleteMembership(fields,roleCb.bind(role));});}};