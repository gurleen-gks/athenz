/**
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */'use strict';var cov_1252zwlh0s=function(){var path='/Users/gurleenk/athenz_repo_new/athenz/libs/nodejs/auth_core/src/impl/SimpleServiceIdentityProvider.js',hash='cdd6805a38a5011b8b0b23586eb7364bda8d48b6',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/gurleenk/athenz_repo_new/athenz/libs/nodejs/auth_core/src/impl/SimpleServiceIdentityProvider.js',statementMap:{'0':{start:{line:16,column:25},end:{line:16,column:56}},'1':{start:{line:17,column:21},end:{line:17,column:55}},'2':{start:{line:18,column:22},end:{line:18,column:50}},'3':{start:{line:20,column:9},end:{line:20,column:22}},'4':{start:{line:33,column:4},end:{line:33,column:47}},'5':{start:{line:35,column:4},end:{line:35,column:55}},'6':{start:{line:36,column:4},end:{line:36,column:57}},'7':{start:{line:37,column:4},end:{line:37,column:27}},'8':{start:{line:38,column:4},end:{line:38,column:30}},'9':{start:{line:39,column:4},end:{line:39,column:49}},'10':{start:{line:40,column:4},end:{line:40,column:44}},'11':{start:{line:44,column:4},end:{line:44,column:36}},'12':{start:{line:45,column:4},end:{line:45,column:32}},'13':{start:{line:46,column:4},end:{line:46,column:33}},'14':{start:{line:52,column:4},end:{line:52,column:53}},'15':{start:{line:53,column:4},end:{line:53,column:55}},'16':{start:{line:56,column:4},end:{line:58,column:5}},'17':{start:{line:57,column:6},end:{line:57,column:18}},'18':{start:{line:60,column:19},end:{line:67,column:5}},'19':{start:{line:69,column:16},end:{line:69,column:44}},'20':{start:{line:70,column:4},end:{line:70,column:26}},'21':{start:{line:72,column:20},end:{line:72,column:153}},'22':{start:{line:73,column:4},end:{line:73,column:57}},'23':{start:{line:74,column:4},end:{line:74,column:21}},'24':{start:{line:78,column:18},end:{line:78,column:22}},'25':{start:{line:80,column:4},end:{line:84,column:5}},'26':{start:{line:81,column:6},end:{line:81,column:30}},'27':{start:{line:83,column:6},end:{line:83,column:28}},'28':{start:{line:86,column:4},end:{line:86,column:19}},'29':{start:{line:90,column:4},end:{line:90,column:22}},'30':{start:{line:94,column:4},end:{line:94,column:22}},'31':{start:{line:98,column:4},end:{line:98,column:38}},'32':{start:{line:102,column:0},end:{line:102,column:47}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:32,column:2},end:{line:32,column:3}},loc:{start:{line:32,column:58},end:{line:41,column:3}},line:32},'1':{name:'(anonymous_1)',decl:{start:{line:43,column:2},end:{line:43,column:3}},loc:{start:{line:43,column:22},end:{line:47,column:3}},line:43},'2':{name:'(anonymous_2)',decl:{start:{line:49,column:2},end:{line:49,column:3}},loc:{start:{line:49,column:39},end:{line:75,column:3}},line:49},'3':{name:'(anonymous_3)',decl:{start:{line:77,column:2},end:{line:77,column:3}},loc:{start:{line:77,column:23},end:{line:87,column:3}},line:77},'4':{name:'(anonymous_4)',decl:{start:{line:89,column:2},end:{line:89,column:3}},loc:{start:{line:89,column:12},end:{line:91,column:3}},line:89},'5':{name:'(anonymous_5)',decl:{start:{line:93,column:2},end:{line:93,column:3}},loc:{start:{line:93,column:16},end:{line:95,column:3}},line:93},'6':{name:'(anonymous_6)',decl:{start:{line:97,column:2},end:{line:97,column:3}},loc:{start:{line:97,column:32},end:{line:99,column:3}},line:97}},branchMap:{'0':{loc:{start:{line:56,column:4},end:{line:58,column:5}},type:'if',locations:[{start:{line:56,column:4},end:{line:58,column:5}},{start:{line:56,column:4},end:{line:58,column:5}}],line:56},'1':{loc:{start:{line:56,column:8},end:{line:56,column:68}},type:'binary-expr',locations:[{start:{line:56,column:8},end:{line:56,column:35}},{start:{line:56,column:39},end:{line:56,column:68}}],line:56}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0},b:{'0':[0,0],'1':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var PrincipalAuthority=(cov_1252zwlh0s.s[0]++,require('./PrincipalAuthority'));var PrincipalToken=(cov_1252zwlh0s.s[1]++,require('../token/PrincipalToken'));var SimplePrincipal=(cov_1252zwlh0s.s[2]++,require('./SimplePrincipal'));var os=(cov_1252zwlh0s.s[3]++,require('os'));class SimpleServiceIdentityProvider{/**
   * A simple implementation of the ServiceIdentityProvider interface.
   * The caller specifies the domain and service name along with the
   * private key for the given service
   * @param domainName Name of the domain
   * @param serviceName Name of the service
   * @param privateKey the private key for the service
   * @param keyId the registered key id in ZMS for this private key
   */constructor(domainName,serviceName,privateKey,keyId){cov_1252zwlh0s.f[0]++;cov_1252zwlh0s.s[4]++;this._Authority=new PrincipalAuthority();cov_1252zwlh0s.s[5]++;this._domain=domainName.toString().toLowerCase();cov_1252zwlh0s.s[6]++;this._service=serviceName.toString().toLowerCase();cov_1252zwlh0s.s[7]++;this._key=privateKey;cov_1252zwlh0s.s[8]++;this._tokenTimeout=3600;cov_1252zwlh0s.s[9]++;this._keyId=keyId.toString().toLowerCase();cov_1252zwlh0s.s[10]++;this.setHost(this._getServerHostName());}static setConfig(c){cov_1252zwlh0s.f[1]++;cov_1252zwlh0s.s[11]++;PrincipalAuthority.setConfig(c);cov_1252zwlh0s.s[12]++;PrincipalToken.setConfig(c);cov_1252zwlh0s.s[13]++;SimplePrincipal.setConfig(c);}getIdentity(domainName,serviceName){cov_1252zwlh0s.f[2]++;cov_1252zwlh0s.s[14]++;// all the role members in Athenz are normalized to lower case so we need to make
// sure our principal's name and domain are created with lower case as well
domainName=domainName.toString().toLowerCase();cov_1252zwlh0s.s[15]++;serviceName=serviceName.toString().toLowerCase();// make sure we're handling correct domain and service
cov_1252zwlh0s.s[16]++;if((cov_1252zwlh0s.b[1][0]++,domainName!==this._domain)||(cov_1252zwlh0s.b[1][1]++,serviceName!==this._service)){cov_1252zwlh0s.b[0][0]++;cov_1252zwlh0s.s[17]++;return null;}else{cov_1252zwlh0s.b[0][1]++;}var tokenObj=(cov_1252zwlh0s.s[18]++,{version:'S1',domain:domainName,name:serviceName,expirationWindow:this._tokenTimeout,host:this._host,keyId:this._keyId});var token=(cov_1252zwlh0s.s[19]++,new PrincipalToken(tokenObj));cov_1252zwlh0s.s[20]++;token.sign(this._key);var principal=(cov_1252zwlh0s.s[21]++,SimplePrincipal.createByUserIdentity(domainName,serviceName,token.getSignedToken(),Math.floor(Date.now()/1000),this._Authority));cov_1252zwlh0s.s[22]++;principal.setUnsignedCreds(token.getUnsignedToken());cov_1252zwlh0s.s[23]++;return principal;}_getServerHostName(){cov_1252zwlh0s.f[3]++;var urlhost=(cov_1252zwlh0s.s[24]++,null);cov_1252zwlh0s.s[25]++;try{cov_1252zwlh0s.s[26]++;urlhost=os.hostname();}catch(e){cov_1252zwlh0s.s[27]++;urlhost='localhost';}cov_1252zwlh0s.s[28]++;return urlhost;}getHost(){cov_1252zwlh0s.f[4]++;cov_1252zwlh0s.s[29]++;return this._host;}setHost(host){cov_1252zwlh0s.f[5]++;cov_1252zwlh0s.s[30]++;this._host=host;}setTokenTimeout(tokenTimeout){cov_1252zwlh0s.f[6]++;cov_1252zwlh0s.s[31]++;this._tokenTimeout=tokenTimeout;}}cov_1252zwlh0s.s[32]++;module.exports=SimpleServiceIdentityProvider;