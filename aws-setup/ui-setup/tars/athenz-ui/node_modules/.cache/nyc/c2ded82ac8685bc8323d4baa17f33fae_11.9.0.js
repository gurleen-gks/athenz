/**
 * Copyright 2016 Yahoo Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */'use strict';var cov_1pdqlddwvq=function(){var path='/Users/gurleenk/athenz_repo_new/athenz/ui/src/routeHandlers/main.js',hash='cc58d190c7dc0a5a0f7699610c3a84c1394f9c14',Function=function(){}.constructor,global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/gurleenk/athenz_repo_new/athenz/ui/src/routeHandlers/main.js',statementMap:{'0':{start:{line:18,column:21},end:{line:18,column:55}},'1':{start:{line:19,column:8},end:{line:19,column:25}},'2':{start:{line:21,column:16},end:{line:21,column:40}},'3':{start:{line:22,column:15},end:{line:22,column:38}},'4':{start:{line:23,column:19},end:{line:23,column:38}},'5':{start:{line:24,column:20},end:{line:24,column:44}},'6':{start:{line:27,column:2},end:{line:32,column:3}},'7':{start:{line:28,column:4},end:{line:31,column:7}},'8':{start:{line:33,column:2},end:{line:33,column:27}},'9':{start:{line:36,column:0},end:{line:122,column:2}},'10':{start:{line:38,column:4},end:{line:38,column:39}},'11':{start:{line:39,column:4},end:{line:39,column:28}},'12':{start:{line:41,column:4},end:{line:60,column:7}},'13':{start:{line:44,column:6},end:{line:52,column:7}},'14':{start:{line:45,column:8},end:{line:45,column:65}},'15':{start:{line:46,column:13},end:{line:52,column:7}},'16':{start:{line:47,column:8},end:{line:47,column:34}},'17':{start:{line:48,column:22},end:{line:48,column:63}},'18':{start:{line:49,column:8},end:{line:51,column:9}},'19':{start:{line:50,column:10},end:{line:50,column:36}},'20':{start:{line:54,column:6},end:{line:57,column:7}},'21':{start:{line:55,column:8},end:{line:56,column:81}},'22':{start:{line:59,column:6},end:{line:59,column:13}},'23':{start:{line:63,column:4},end:{line:63,column:28}},'24':{start:{line:66,column:19},end:{line:69,column:5}},'25':{start:{line:71,column:4},end:{line:71,column:33}},'26':{start:{line:74,column:19},end:{line:74,column:48}},'27':{start:{line:76,column:19},end:{line:80,column:5}},'28':{start:{line:82,column:16},end:{line:87,column:5}},'29':{start:{line:83,column:6},end:{line:86,column:7}},'30':{start:{line:84,column:8},end:{line:84,column:49}},'31':{start:{line:85,column:8},end:{line:85,column:46}},'32':{start:{line:89,column:4},end:{line:105,column:5}},'33':{start:{line:90,column:6},end:{line:104,column:9}},'34':{start:{line:91,column:8},end:{line:103,column:11}},'35':{start:{line:96,column:10},end:{line:96,column:36}},'36':{start:{line:97,column:10},end:{line:101,column:11}},'37':{start:{line:98,column:12},end:{line:98,column:69}},'38':{start:{line:100,column:12},end:{line:100,column:51}},'39':{start:{line:102,column:10},end:{line:102,column:33}},'40':{start:{line:108,column:4},end:{line:119,column:7}},'41':{start:{line:109,column:6},end:{line:118,column:7}},'42':{start:{line:111,column:10},end:{line:111,column:50}},'43':{start:{line:113,column:10},end:{line:113,column:53}},'44':{start:{line:115,column:10},end:{line:115,column:52}},'45':{start:{line:117,column:10},end:{line:117,column:29}}},fnMap:{'0':{name:'notFound',decl:{start:{line:26,column:9},end:{line:26,column:17}},loc:{start:{line:26,column:28},end:{line:34,column:1}},line:26},'1':{name:'(anonymous_1)',decl:{start:{line:37,column:8},end:{line:37,column:9}},loc:{start:{line:37,column:33},end:{line:61,column:3}},line:37},'2':{name:'(anonymous_2)',decl:{start:{line:43,column:23},end:{line:43,column:24}},loc:{start:{line:43,column:43},end:{line:60,column:5}},line:43},'3':{name:'(anonymous_3)',decl:{start:{line:62,column:12},end:{line:62,column:13}},loc:{start:{line:62,column:31},end:{line:64,column:3}},line:62},'4':{name:'(anonymous_4)',decl:{start:{line:65,column:8},end:{line:65,column:9}},loc:{start:{line:65,column:27},end:{line:72,column:3}},line:65},'5':{name:'(anonymous_5)',decl:{start:{line:73,column:17},end:{line:73,column:18}},loc:{start:{line:73,column:36},end:{line:106,column:3}},line:73},'6':{name:'(anonymous_6)',decl:{start:{line:82,column:16},end:{line:82,column:17}},loc:{start:{line:82,column:32},end:{line:87,column:5}},line:82},'7':{name:'(anonymous_7)',decl:{start:{line:90,column:33},end:{line:90,column:34}},loc:{start:{line:90,column:49},end:{line:104,column:7}},line:90},'8':{name:'(anonymous_8)',decl:{start:{line:95,column:8},end:{line:95,column:9}},loc:{start:{line:95,column:30},end:{line:103,column:9}},line:95},'9':{name:'(anonymous_9)',decl:{start:{line:107,column:16},end:{line:107,column:17}},loc:{start:{line:107,column:35},end:{line:120,column:3}},line:107},'10':{name:'(anonymous_10)',decl:{start:{line:108,column:41},end:{line:108,column:42}},loc:{start:{line:108,column:52},end:{line:119,column:5}},line:108}},branchMap:{'0':{loc:{start:{line:27,column:2},end:{line:32,column:3}},type:'if',locations:[{start:{line:27,column:2},end:{line:32,column:3}},{start:{line:27,column:2},end:{line:32,column:3}}],line:27},'1':{loc:{start:{line:27,column:5},end:{line:27,column:67}},type:'binary-expr',locations:[{start:{line:27,column:5},end:{line:27,column:25}},{start:{line:27,column:29},end:{line:27,column:67}}],line:27},'2':{loc:{start:{line:44,column:6},end:{line:52,column:7}},type:'if',locations:[{start:{line:44,column:6},end:{line:52,column:7}},{start:{line:44,column:6},end:{line:52,column:7}}],line:44},'3':{loc:{start:{line:46,column:13},end:{line:52,column:7}},type:'if',locations:[{start:{line:46,column:13},end:{line:52,column:7}},{start:{line:46,column:13},end:{line:52,column:7}}],line:46},'4':{loc:{start:{line:46,column:16},end:{line:46,column:43}},type:'binary-expr',locations:[{start:{line:46,column:16},end:{line:46,column:20}},{start:{line:46,column:24},end:{line:46,column:43}}],line:46},'5':{loc:{start:{line:49,column:8},end:{line:51,column:9}},type:'if',locations:[{start:{line:49,column:8},end:{line:51,column:9}},{start:{line:49,column:8},end:{line:51,column:9}}],line:49},'6':{loc:{start:{line:54,column:6},end:{line:57,column:7}},type:'if',locations:[{start:{line:54,column:6},end:{line:57,column:7}},{start:{line:54,column:6},end:{line:57,column:7}}],line:54},'7':{loc:{start:{line:83,column:6},end:{line:86,column:7}},type:'if',locations:[{start:{line:83,column:6},end:{line:86,column:7}},{start:{line:83,column:6},end:{line:86,column:7}}],line:83},'8':{loc:{start:{line:89,column:4},end:{line:105,column:5}},type:'if',locations:[{start:{line:89,column:4},end:{line:105,column:5}},{start:{line:89,column:4},end:{line:105,column:5}}],line:89},'9':{loc:{start:{line:97,column:10},end:{line:101,column:11}},type:'if',locations:[{start:{line:97,column:10},end:{line:101,column:11}},{start:{line:97,column:10},end:{line:101,column:11}}],line:97},'10':{loc:{start:{line:109,column:6},end:{line:118,column:7}},type:'switch',locations:[{start:{line:110,column:8},end:{line:111,column:50}},{start:{line:112,column:8},end:{line:113,column:53}},{start:{line:114,column:8},end:{line:115,column:52}},{start:{line:116,column:8},end:{line:117,column:29}}],line:109}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0,0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var NodeRestClient=(cov_1pdqlddwvq.s[0]++,require('node-rest-client').Client);var _=(cov_1pdqlddwvq.s[1]++,require('lodash'));var pageUtils=(cov_1pdqlddwvq.s[2]++,require('../utils/page'));var reqUtils=(cov_1pdqlddwvq.s[3]++,require('../utils/req'));var domainRoutes=(cov_1pdqlddwvq.s[4]++,require('./domain'));var domainHandler=(cov_1pdqlddwvq.s[5]++,require('../api/domain'));function notFound(req,res){cov_1pdqlddwvq.f[0]++;cov_1pdqlddwvq.s[6]++;if((cov_1pdqlddwvq.b[1][0]++,req.method==='GET')&&(cov_1pdqlddwvq.b[1][1]++,req.originalUrl.indexOf('ajax')===-1)){cov_1pdqlddwvq.b[0][0]++;cov_1pdqlddwvq.s[7]++;return res.render('404',{pageTitle:'404 Not Found',url:req.originalUrl});}else{cov_1pdqlddwvq.b[0][1]++;}cov_1pdqlddwvq.s[8]++;res.status(404).send('');}cov_1pdqlddwvq.s[9]++;module.exports={init:function(req,res,next){cov_1pdqlddwvq.f[1]++;cov_1pdqlddwvq.s[10]++;pageUtils.initCommonData(req,res);cov_1pdqlddwvq.s[11]++;res.locals.domains=[];cov_1pdqlddwvq.s[12]++;domainHandler.fetchUserDomains({userId:req.user.userDomain},req.restClient,function(err,data){cov_1pdqlddwvq.f[2]++;cov_1pdqlddwvq.s[13]++;if(err){cov_1pdqlddwvq.b[2][0]++;cov_1pdqlddwvq.s[14]++;reqUtils.populateAppContextErrorMessage(res.locals,err);}else{cov_1pdqlddwvq.b[2][1]++;cov_1pdqlddwvq.s[15]++;if((cov_1pdqlddwvq.b[4][0]++,!err)&&(cov_1pdqlddwvq.b[4][1]++,Array.isArray(data))){cov_1pdqlddwvq.b[3][0]++;cov_1pdqlddwvq.s[16]++;res.locals.domains=data;var current=(cov_1pdqlddwvq.s[17]++,_.find(data,{name:req.params.domainId}));cov_1pdqlddwvq.s[18]++;if(current){cov_1pdqlddwvq.b[5][0]++;cov_1pdqlddwvq.s[19]++;current.active='active';}else{cov_1pdqlddwvq.b[5][1]++;}}else{cov_1pdqlddwvq.b[3][1]++;}}cov_1pdqlddwvq.s[20]++;if(res.locals.domains.length===0){cov_1pdqlddwvq.b[6][0]++;cov_1pdqlddwvq.s[21]++;res.locals.noDomains='You do not have any domains that you belong to or are an admin of.';}else{cov_1pdqlddwvq.b[6][1]++;}cov_1pdqlddwvq.s[22]++;next();});},redirect:function(req,res){cov_1pdqlddwvq.f[3]++;cov_1pdqlddwvq.s[23]++;res.redirect('/athenz');},home:function(req,res){cov_1pdqlddwvq.f[4]++;var viewData=(cov_1pdqlddwvq.s[24]++,{pageTitle:'Home',noHeaderSearch:true});cov_1pdqlddwvq.s[25]++;res.render('home',viewData);},manageDomains:function(req,res){cov_1pdqlddwvq.f[5]++;var apiCount=(cov_1pdqlddwvq.s[26]++,res.locals.domains.length|0);var viewData=(cov_1pdqlddwvq.s[27]++,{pageTitle:'Manage Domains',manageDomainActive:'active',section:{id:'Manage My Domains'}});cov_1pdqlddwvq.s[28]++;var apiCb=function(count){cov_1pdqlddwvq.f[6]++;cov_1pdqlddwvq.s[29]++;if(count===0){cov_1pdqlddwvq.b[7][0]++;cov_1pdqlddwvq.s[30]++;pageUtils.setAppContextMessage(req,res);cov_1pdqlddwvq.s[31]++;res.render('managedomains',viewData);}else{cov_1pdqlddwvq.b[7][1]++;}};cov_1pdqlddwvq.s[32]++;if(res.locals.domains.length>0){cov_1pdqlddwvq.b[8][0]++;cov_1pdqlddwvq.s[33]++;res.locals.domains.forEach(function(domain){cov_1pdqlddwvq.f[7]++;cov_1pdqlddwvq.s[34]++;domainHandler.fetchDomainMetadata({domainId:domain.name},req.restClient,function(err,result){cov_1pdqlddwvq.f[8]++;cov_1pdqlddwvq.s[35]++;domain.domainDetails={};cov_1pdqlddwvq.s[36]++;if(err){cov_1pdqlddwvq.b[9][0]++;cov_1pdqlddwvq.s[37]++;reqUtils.populateAppContextErrorMessage(res.locals,err);}else{cov_1pdqlddwvq.b[9][1]++;cov_1pdqlddwvq.s[38]++;_.assign(domain.domainDetails,result);}cov_1pdqlddwvq.s[39]++;apiCb(--apiCount,err);});});}else{cov_1pdqlddwvq.b[8][1]++;}},domainRoutes:function(req,res){cov_1pdqlddwvq.f[9]++;cov_1pdqlddwvq.s[40]++;domainRoutes.domainDetails(req,res,function(){cov_1pdqlddwvq.f[10]++;cov_1pdqlddwvq.s[41]++;switch(req.params.section){case'role':cov_1pdqlddwvq.b[10][0]++;cov_1pdqlddwvq.s[42]++;return domainRoutes.roleRoute(req,res);case'service':cov_1pdqlddwvq.b[10][1]++;cov_1pdqlddwvq.s[43]++;return domainRoutes.serviceRoute(req,res);case'policy':cov_1pdqlddwvq.b[10][2]++;cov_1pdqlddwvq.s[44]++;return domainRoutes.policyRoute(req,res);default:cov_1pdqlddwvq.b[10][3]++;cov_1pdqlddwvq.s[45]++;notFound(req,res);}});},notFound:notFound};